<!DOCTYPE html>
<html>
<head>
<title>ColorUtil example</title>
<script src="/ColorUtil.js"></script>
</head>

<body>
<input type="range" min="0" max="50" value="0" step="5" oninput="showValue(this.value)" />
<span id="range">0</span>

<canvas id="gradient1"></canvas>
<canvas id="matrix1"></canvas>
<canvas id="matrix2"></canvas>
<canvas id="matrix3"></canvas>
<canvas id="test1"></canvas>
<canvas id="test2"></canvas>

<script>

let gradient1 = [0xED146F, 0xEDDE45, 0x9BF0E9];
let matrix1 = [[0xED146F, 0xEDDE45, 0x9BF0E9]];
let matrix2 = [[0xFF0000, 0xFFFF00], [0x0000FF, 0x00FFFF]];
let matrix3 = [[0xFFFFFF], [0xFF0000, 0x00FF00], [0x0000FF, 0xFF00FF, 0x00FFFF]];

let conversions = [ColorUtil.dec2systemEndianUint32];
matrix1 = ColorUtil.convert(matrix1, ...conversions);
matrix2 = ColorUtil.convert(matrix2, ...conversions);
matrix3 = ColorUtil.convert(matrix3, ...conversions);

createGradient('gradient1', gradient1, 200, 200);
createMatrix('matrix1', matrix1, 200, 200);
createMatrix('matrix2', matrix2, 200, 200);
createMatrix('matrix3', matrix3, 200, 200);

function showValue(newValue) {
    document.getElementById("range").innerHTML=newValue;
}

function createGradient(targetId, gradient, width, height) {
    let canvas = document.getElementById(targetId);
    let ctx = canvas.getContext('2d');

    canvas.width = width;
    canvas.height = height;

    for(let x = 0; x < width; x++) {
        let color = ColorUtil.getGradientColor(gradient, x/width);
        let hex = ColorUtil.dec2hex(color);

        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, height);
        ctx.strokeStyle = hex;
        ctx.stroke();
    }
}

function createMatrix(targetId, matrix, width, height) {
    let canvas = document.getElementById(targetId);
    let ctx = canvas.getContext('2d');

    canvas.width = width;
    canvas.height = height;

    let imageData  = ctx.createImageData(width, height);
    let buffer = imageData.data.buffer;
    let uint32View = new Uint32Array(buffer);
    let uint8CView = new Uint8ClampedArray(buffer);

    for(let x = 0; x < width; x++) {

        for(let y = 0; y < height; y++) {

            uint32View[y * width + x] = ColorUtil.getGradientMatrixColor(matrix, x/width, y/height) + (0xFF << 24);
        }
    }

    imageData.data.set(uint8CView);

    ctx.putImageData(imageData, 0, 0);
}


// test1
(()=> {
    let canvas = document.getElementById('test1');
    let ctx = canvas.getContext('2d');
    ctx.fillStyle = '#AABBCC';
    ctx.fillRect(0,0,10,10);
    let imageData  = ctx.getImageData(0,0,10,10);
    let buffer = imageData.data.buffer;
    let uint32View = new Uint32Array(buffer);
    let uint8CView = new Uint8ClampedArray(buffer);
    console.log('Test1: set canvas color 0xAABBCC and see what it is in typed arrays');
    console.log('uint32View', (uint32View[0]).toString(16));
    console.log('uint8CView', uint8CView[0], uint8CView[1], uint8CView[2], uint8CView[3]);
    // with little-endian system the colors are
    // input format: RGB
    // unit32View: ABGR
    // uint8CView: RGBA
})();

// test2
(()=> {
    let canvas = document.getElementById('test2');
    let ctx = canvas.getContext('2d');
    let imageData  = ctx.getImageData(0,0,10,10);
    let buffer = imageData.data.buffer;
    let uint32View = new Uint32Array(buffer);
    let int32View = new Int32Array(buffer);
    let uint8CView = new Uint8ClampedArray(buffer);
    for (let [i, c] of uint32View.entries()) {
        int32View[i] = (0xFF << 24) | 0x0000FF; // set alpha + red
        // uint32View[i] = (0xFF << 24) | 0x0000FF; // set alpha + red
    }
    imageData.data.set(uint8CView);
    ctx.putImageData(imageData, 0, 0);
    console.log('Test1: set color as negative number with int32View');
    console.log('<< operator transforms to signed 32-bit. resulting integer will be negative number');
    console.log('uint32View', (uint32View[0]).toString(16));
    console.log('int32View', (int32View[0]).toString(16));
    console.log('uint8CView', uint8CView[0], uint8CView[1], uint8CView[2], uint8CView[3]);
})();

console.log(ColorUtil.dec2systemEndianUint32(0xAABBCC));

</script>

</body>

</html>