<!DOCTYPE html>
<html>
<head>
<title>Endian</title>
<script src="/ColorUtil.js"></script>
</head>
<body>
<canvas id="canvas"></canvas>

<script>

// convert colors to rgb objects so getGradientMatrixColor understands them
// colors are written in 0xRRGGBBAA (big-endian) format and converted to rgb objects
let colors = ColorUtil.convert(
    [[0xFF0000FF, 0xFFFF0099], [0x0000FF66, 0x00FFFF22]],
    ColorUtil.int32b.toRgb);

let width = 300;
let height = 300;

let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');
let imageData  = ctx.createImageData(width, height);
let buffer = imageData.data.buffer;
let uint32View = new Uint32Array(buffer);
let uint8CView = new Uint8ClampedArray(buffer);

canvas.width = width;
canvas.height = height;

// determine endianness outside the loop.
// here we use toUint32 for little-endian and toUint32b for big-endian systems
let toUint32 = ColorUtil.endian === 0 ?
    ColorUtil.rgb.toUint32 : ColorUtil.rgb.toUint32b;

for(let x = 0; x < width; x++) {

    for(let y = 0; y < height; y++) {

        let rgb = ColorUtil.matrixColor(colors, x/width, y/height);

        uint32View[y * width + x] = toUint32(rgb);
    }
}

imageData.data.set(uint8CView);

ctx.putImageData(imageData, 0, 0);

</script>

</body>

</html>