<!DOCTYPE html>
<html>
<head>
<title>Repeat and scaling</title>
<script src="/ColorUtil.js"></script>

<style>

form {
  width: 400px;
  border: 1px dashed #CCC;
}

form > div {
    padding-bottom: 10px;
}

label {
    display: inline-block;
    width: 150px;
    text-align: right;
}
</style>
</head>
<body>
<form>
    <div>
        <label for='canvasWidthSlider'>canvas width</label>
        <input type='range' id='canvasWidthSlider' value='300' min='10' max='500' step='10' oninput='onCanvasWidthChange(this)' style='width:150px;'>
        <span id='canvasWidthSliderValue'></span>
    </div>
    <div>
        <label for='canvasHeightSlider'>canvas height</label>
        <input type='range' id='canvasHeightSlider' value='300' min='10' max='500' step='10' oninput='onCanvasHeightChange(this)' style='width:150px;'>
        <span id='canvasHeightSliderValue'></span>
    </div>
    <div>
        <label for='gradientTypePulldown'>gradient type</label>
        <select id='gradientTypePulldown' onchange='onGradientTypeChange(this)'>
            <option value="linear">linear</option>
            <option value="linearMatrix">linear matrix</option>
            <option value="circular">circular</option>
            <option value="circularMatrix">circular matrix</option>
        </select>
    </div>
    <div>
        <label for='widthSlider'>gradient width</label>
        <input type='range' id='widthSlider' value='300' min='0' max='500' step='10' oninput='onWidthChange(this)' style='width:150px;'>
        <span id='widthSliderValue'></span>
    </div>
    <div>
        <label for='heightSlider'>gradient height</label>
        <input type='range' id='heightSlider' value='300' min='0' max='500' step='10' oninput='onHeightChange(this)' style='width:150px;'>
        <span id='heightSliderValue'></span>
    </div>
    <div>
        <label for='centerXSlider'>gradient center X</label>
        <input type='range' id='centerXSlider' value='0.5' min='-2' max='2' step='0.1' oninput='onCenterXChange(this)' style='width:150px;'>
        <span id='centerXSliderValue'></span>
    </div>
    <div>
        <label for='centerYSlider'>gradient center Y</label>
        <input type='range' id='centerYSlider' value='0.5' min='-2' max='2' step='0.1' oninput='onCenterYChange(this)' style='width:150px;'>
        <span id='centerYSliderValue'></span>
    </div>

    <div>
        <label for='translateXSlider'>translateX</label>
        <input type='range' id='translateXSlider' value='0' min='-2' max='2' step='0.1' oninput='onTranslateXChange(this)' style='width:150px;'>
        <span id='translateXSliderValue'></span>
    </div>
    <div>
        <label for='translateYSlider'>translateY</label>
        <input type='range' id='translateYSlider' value='0' min='-2' max='2' step='0.1' oninput='onTranslateYChange(this)' style='width:150px;'>
        <span id='translateYSliderValue'></span>
    </div>

    <div>
        <label for='rotationSlider'>gradient rotation</label>
        <input type='range' id='rotationSlider' value='0' min='-1' max='1' step='0.01' oninput='onRotationChange(this)' style='width:150px;'>
        <span id='rotationSliderValue'></span>
    </div>
    <div>
        <label for='repeatPulldown'>gradient x Repeat</label>
        <select id='repeatPulldown' onchange='repeatChange(this)'>
            <option value="stop">ColorUtil.Repeat.stop</option>
            <option value="repeat">ColorUtil.Repeat.repeat</option>
        </select>
    </div>
    <div>
        <label for='repeatPulldown2'>gradient y Repeat (matrix only)</label>
        <select id='repeatPulldown2' onchange='repeat2Change(this)'>
            <option value="stop">ColorUtil.Repeat.stop</option>
            <option value="repeat">ColorUtil.Repeat.repeat</option>
        </select>
    </div>
</form>

<canvas id="canvas"></canvas>

<script>

// This code isn't probably a good example to look at.
// The purpose is to give controls to play so you can better see
// how the controls affect the gradient

let gradientColors = ColorUtil.convert(
    [0xFF0000, 0xFFFF00, 0x0000FF, 0x00FFFF],
    ColorUtil.int.toRgb);

let matrixColors = ColorUtil.convert(
    [[0xFF0000, 0xFFFF00], [0x0000FF, 0x00FFFF]],
    ColorUtil.int.toRgb);

let circleGradientColors = ColorUtil.rgb.hueColors();

let circleMatrixColors = [[{r:255, g: 255, b: 255, a: 255}], ColorUtil.rgb.hueColors()];

let gradientType = 'linear';
let gradientWidth = 300;
let gradientHeight = 300;
let canvasWidth = 300;
let canvasHeight = 300;
let gradientCenterX = 0.5;
let gradientCenterY = 0.5;
let translateX = 0;
let translateY = 0;
let gradientRotation = 0;
let repeat = ColorUtil.Repeat.stop;
let repeat2 = ColorUtil.Repeat.stop;

updateCanvas();

function onCanvasWidthChange(input) {
    canvasWidth = parseInt(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onCanvasHeightChange(input) {
    canvasHeight = parseInt(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onGradientTypeChange(input) {
    gradientType = input.value;
    updateCanvas();
}

function onWidthChange(input) {
    gradientWidth = parseInt(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onHeightChange(input) {
    gradientHeight = parseInt(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onCenterXChange(input) {
    gradientCenterX = parseFloat(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onCenterYChange(input) {
    gradientCenterY = parseFloat(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onTranslateXChange(input) {
    translateX = parseFloat(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onTranslateYChange(input) {
    translateY = parseFloat(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function onRotationChange(input) {
    gradientRotation = parseFloat(input.value);
    updateSliderValueDisplay(input);
    updateCanvas();
}

function repeatChange(input) {
    repeat = ColorUtil.Repeat[input.value];
    updateCanvas();
}

function repeat2Change(input) {
    repeat2 = ColorUtil.Repeat[input.value];
    updateCanvas();
}

function updateCanvas() {
    if (gradientType === 'linear') {
        updateGradient('linear', gradientColors)

    } else if (gradientType === 'linearMatrix') {
        updateGradient('linear', matrixColors)

    } else if (gradientType === 'circularMatrix') {
        updateGradient('circular', circleMatrixColors);

    } else if (gradientType === 'circular') {
        updateGradient('circular', circleGradientColors);
    }
}

function updateGradient(type, colors) {
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let imageData  = ctx.createImageData(canvasWidth, canvasHeight);
    let buffer = imageData.data.buffer;
    let uint32View = new Uint32Array(buffer);
    let uint8CView = new Uint8ClampedArray(buffer);

    canvas.width = canvasWidth;
    canvas.height = canvasHeight;

    let gradientFunction = ColorUtil.rgb.createGradient({
        colors: colors,
        type: type,
        cx: gradientCenterX,
        cy: gradientCenterY,
        translateX: translateX,
        translateY: translateY,
        rotation: gradientRotation,
        xRepeat: repeat,
        yRepeat: repeat2
    })

    for(let x = 0; x < canvasWidth; x++) {

        for(let y = 0; y < canvasHeight; y++) {

            let rgb = gradientFunction(x/gradientWidth, y/gradientHeight);

            uint32View[y * canvasWidth + x] = ColorUtil.rgb.toUint32(rgb);
        }
    }

    imageData.data.set(uint8CView);

    ctx.putImageData(imageData, 0, 0);
}

function updateSliderValueDisplay(slider) {
    document.getElementById(slider.getAttribute('id') + 'Value').innerText = slider.value;
}

</script>

</body>

</html>